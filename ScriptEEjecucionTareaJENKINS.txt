#!/bin/bash

# Variables
REPO_URL="https://github.com/performanceDemon/PythonAllureSelenium-v1.3"
REPO_DIR="PythonAllureSelenium-v1.3"

# Actualiza e instala dependencias necesarias
sudo apt update
sudo apt install -y wget gnupg python3-pip git python3-venv

# Instalar Google Chrome (si no estÃ¡ ya instalado)
if ! command -v google-chrome &> /dev/null; then
  wget -q -O - https://dl.google.com/linux/linux_signing_key.pub | sudo apt-key add -
  echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" | sudo tee /etc/apt/sources.list.d/google-chrome.list
  sudo apt update
  sudo apt install -y google-chrome-stable
fi

# Clonar o actualizar el repositorio
if [ ! -d "$REPO_DIR" ]; then
  git clone $REPO_URL
else
  cd $REPO_DIR
  git pull origin main
  cd ..
fi

cd $REPO_DIR

# Crear y activar el entorno virtual
python3 -m venv venv
source venv/bin/activate

# Instalar dependencias del proyecto
pip install -r requirements.txt

# Ejecutar las pruebas con pytest
pytest --alluredir=allure-results

# Desactivar el entorno virtual
deactivate
